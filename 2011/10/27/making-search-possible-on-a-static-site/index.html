<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>

Making search possible on a static site   | Eric van Zanten &#8211; Statically</title>

<link rel="stylesheet" href="http://www.static-eric.com/wp-content/themes/tabula-rosa/style.css" type="text/css" media="screen" />


<link rel="alternate" type="application/rss+xml" title="Eric van Zanten - Statically &raquo; Feed" href="http://www.static-eric.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Eric van Zanten - Statically &raquo; Comments Feed" href="http://www.static-eric.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Eric van Zanten - Statically &raquo; Making search possible on a static site Comments Feed" href="http://www.static-eric.com/2011/10/27/making-search-possible-on-a-static-site/feed/" />
<link rel='stylesheet' id='fancybox_css-css'  href='http://www.static-eric.com/wp-content/themes/tabula-rosa/js/fancybox/jquery.fancybox-1.3.4.css?ver=3.2.1' type='text/css' media='screen' />
<script type='text/javascript' src='http://www.static-eric.com/wp-includes/js/l10n.js?ver=20101110'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-includes/js/jquery/jquery.js?ver=1.6.1'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-includes/js/comment-reply.js?ver=20090102'></script>

 
<link rel='index' title='Eric van Zanten &#8211; Statically' href='http://www.static-eric.com/' />
<link rel='start' title='OMG FREE HOSTING: An homage to Harper Reed' href='http://www.static-eric.com/2011/10/22/omg-free-hosting-an-homage-to-harper-reed/' />
<link rel='prev' title='2010 Census: Getting setup' href='http://www.static-eric.com/2011/10/24/2010-census-getting-setup/' />
<link rel='next' title='Mapping tools 101: A few things I&#8217;ve picked up' href='http://www.static-eric.com/2011/10/29/mapping-tools-101-a-few-things-ive-picked-up/' />
<meta name="generator" content="WordPress 3.2.1 - Realstatic 0.31" />
<link rel='canonical' href='http://www.static-eric.com/2011/10/27/making-search-possible-on-a-static-site/' />
<link rel='shortlink' href='http://www.static-eric.com/?p=45/' />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />

<!-- BEGIN Typekit Fonts for WordPress -->
<script type="text/javascript" src="http://use.typekit.com/sok4ukf.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script><!-- END Typekit Fonts for WordPress -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26502031-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body class="single single-post postid-45 single-format-standard">
		
	<div id="header">
		<div id="header-wrapper">
		<h1 id="blog-title"><a href="http://www.static-eric.com/" title="Home">Eric van Zanten &#8211; Statically</a></h1>       
        <h2 id="blog-description"></h2>
        
        <!-- Design Note: Add breadcrumbs here at the end of this logic -->
        			<h2 class="breadcrumb"><a href="http://www.static-eric.com/">Home</a> - 
									<a href="http://www.static-eric.com/category/code/" title="Code">Code</a> - <a href="http://www.static-eric.com/category/how-tos/" title="How-Tos">How-Tos</a> - Making search possible on a static site				</h2>
					</h2>
		</div>
	</div>

<div id="wrapper">
	<div id="left-col">
			<div id="menu">
		<ul>
						<li class="page_item"><a href="http://www.static-eric.com/">Home</a></li>
						<li class="page_item page-item-10"><a href="http://www.static-eric.com/about-this-site/" title="About this site">About this site</a></li>
		</ul>
	</div>


		<div id="sidebar">
        	<div id="feed-container">
        		<p><a href="http://feeds.feedburner.com/static-eric" id="feed_link">Subscribe to the RSS Feed</a></p>
        	</div>

						
			<div class="widget static-widget">
				<h3 class="widgettitle">Archives</h3>
				<ul>
						<li><a href='http://www.static-eric.com/2011/10/' title='October 2011'>October 2011</a></li>
				</ul>
			</div>
			
			<div class="widget static-widget">
				<h3 class="widgettitle">Categories</h3>
				<ul>
						<li class="cat-item cat-item-3"><a href="http://www.static-eric.com/category/code/" title="View all posts filed under Code">Code</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://www.static-eric.com/category/how-tos/" title="View all posts filed under How-Tos">How-Tos</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://www.static-eric.com/category/maps/" title="View all posts filed under Maps">Maps</a>
</li>
				</ul>
			</div>
			<div class="widget static-widget">
				<h3 class="widgettitle">Search</h3>
                <form id="searchform">
                <div><input type="text" name="s" id="s" /><input type="button" id="searchsubmit" value="Search" /></div>
                </form>
			</div>
			<div id="search-results"></div>
				</div>
	</div>

	<div id="right-col">
					<div id="post-45" class="post-45 post type-post status-publish format-standard hentry category-code category-how-tos tag-google-appengine tag-javascript tag-jquery tag-python">
						<h1 class="posttitle">Making search possible on a static site</h1>
			<div class="post-author">written by: Eric</div>
	
			<div class="entry">
				<p>One of the challenges I identified early one when <a title="OMG FREE HOSTING: An homage to Harper Reed" href="http://www.static-eric.com/2011/10/22/omg-free-hosting-an-homage-to-harper-reed/" target="_blank">setting up this site</a> was that it was going to be a bit tricky to get some kind of search tool working for it. When I Googled it, I was pretty excited to find <a title="Tapir search" href="http://tapirgo.com/" target="_blank">this tool</a> but when I sat down yesterday to implement it, it was broke. And by broke, I mean it wasn&#8217;t returning any results and the developers weren&#8217;t responding to any attempts at communications. So, I figured, if they can parse my RSS feed and turn it into something that returns search results, so can I. What follows is how I managed to get that going.</p>
<p><strong>AppEngine, again</strong></p>
<p>It seems like recently I&#8217;ve found quite a few uses for AppEngine. And this is without even really having it on my radar before last week. Besides serving this site from it, a coworker and I put together a little email handler for a <a title="Wufoo" href="http://wufoo.com" target="_blank">Wufoo</a> form on AppEngine earlier this week. So, when my dream of making this site only rely on external web services for interactivity fell apart at some point yesterday, I guess it seemed like a natural fit.</p>
<p>Really, all that the search widget over there in the right sidebar does is do a jQuery <code>$.getJson</code> call to the AppEngine app which grabs my <a title="Static Eric RSS Feed" href="http://feeds.feedburner.com/static-eric" target="_blank">RSS feed</a> from Feedburner, parses it, looks for the query string in the content of the feed, and then returns a JSONP reponse. Here&#8217;s what that looks like on the AppEngine side:</p>
<pre class="brush: python; title: ; notranslate" title="">

#!/usr/bin/env python
import logging
import json
import webapp2 as webapp
from feedparser import parse

class SearchSite(webapp.RequestHandler):
def get(self):
q = self.request.get('query', '')
cb = self.request.get('callback', '')
tree = parse('http://feeds.feedburner.com/static-eric')
d = {}
resp = []
for entry in tree['entries']:
    if q.lower() in entry['content'][0]['value'].lower():
        props = {}
        props['title'] = entry['title']
        props['updated'] = entry['updated']
        props['summary'] = entry['summary']
        props['link'] = entry['links'][0]['href']
        resp.append(props)
        d['status'] = 'ok'
    else:
        d['status'] = 'no_results'
    d['resp'] = resp
    d = json.dumps(d)
    d = &quot;%s(%s)&quot; % (cb,str(d))
    self.response.out.write(d)

app = webapp.WSGIApplication([('/', SearchSite)], debug=True)
</pre>
<p>Since the client is calling a Cross Domain resource here, the response needs to be a JSONP response in order for jQuery to be cool with it (hence wrapping the json in the callback there). The other really, really cool thing I found was <a title="Feedparser on Google Code" href="http://code.google.com/p/feedparser/" target="_blank">Feedparser. </a>The project is very mature but, unfortunately, the docs were on a domain that was owned by <a title="Mark Pilgrim on Wikipedia" href="http://en.wikipedia.org/wiki/Mark_Pilgrim_%28software_developer%29" target="_blank">Mark Pilgrim</a> (he was a heavy contributor to the project, apparently) so when he performed his recent info-suicide, that domain went with him. They&#8217;re putting docs up onto PyPi soon (at least that&#8217;s what the chatter in their forums is saying)</p>
<p>Anyways, it&#8217;s pretty easy to use. Import the module, give it a URL (or a sting with XML in it) and whammo, you&#8217;ve got a Python dictionary with all the stuff from the feed in it. Since the docs are temporarily gone, I can&#8217;t really say what other types of feeds or XML formats it accepts but it worked for the one that I&#8217;m generating from WordPress.</p>
<p>One other thing about that code that you&#8217;ll notice is that instead of doing the normal <code>from google.appengine.ext import webapp</code> I&#8217;m doing <code>import webapp2 as webapp</code> and I&#8217;m also able to do <code>import json</code> even though AppEngine is still on Python 2.5. This is because in my app.yaml, I told it to use Python 2.7:</p>
<pre class="brush: xml; title: ; notranslate" title="">
application: static-eric-search
version: 1
runtime: python27
api_version: 1
threadsafe: true

handlers:

- url: .*
  script: main.app
</pre>
<p>On the client-side, I&#8217;m just taking the response and sticking it over in a div underneath the search form:</p>
<pre class="brush: jscript; title: ; notranslate" title="">

(function($){
    $('#searchsubmit').live('click', function(){
        $('.result').remove();
        $.getJSON('http://static-eric-search.appspot.com/?query='+$(this).prev().val()+'&amp;callback=?', function(data){
            var info = '';
            if (data['status'] == 'ok'){
                $.each(data['resp'], function(key,val){
                    info += '&lt;div&gt;&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;' + val['title'] + '&lt;/a&gt;&lt;/h4&gt;';
                    info += '&lt;p&gt;&lt;em&gt;Updated: ' + val['updated'] + '&lt;/em&gt;&lt;/p&gt;';
                    info += '&lt;div style=&quot;display:none;&quot;&gt;&lt;p&gt;' + val['summary'] + '&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;'
                });
            } else {
                info += '&lt;div class&quot;result&quot;&gt;&lt;h4&gt;Your search found nothing. Try again&lt;/h4&gt;&lt;/div&gt;';
            }
            $('#search-results').append(info);
        });
    });
    $('.result h4 a').live('click', function(){
    $(this).parent().parent().find('.result-summary').toggle('blind');
});
})(jQuery);
</pre>
<p>So, I guess that&#8217;s pretty much it. That&#8217;s how you get get search working on a static site. It would be really cool to see <a title="Tapir search" href="http://tapirgo.com/" target="_blank">these guys</a> get their act together but, I guess it was kinda fun to do it on my own as well.</p>
								
			</div>
	
			<div class="post-metadata alt">
				<p><strong>Date:</strong> <a href="http://www.static-eric.com/2011/10/27/making-search-possible-on-a-static-site/" rel="bookmark" title="Permanent Link to Making search possible on a static site">October 27th, 2011</a> </p>
				<p><strong>Category:</strong> <a href="http://www.static-eric.com/category/code/" title="View all posts in Code" rel="category tag">Code</a>, <a href="http://www.static-eric.com/category/how-tos/" title="View all posts in How-Tos" rel="category tag">How-Tos</a></p>
				<p><strong>Tags:</strong> <a href="http://www.static-eric.com/tag/google-appengine/" rel="tag">Google AppEngine</a>, <a href="http://www.static-eric.com/tag/javascript/" rel="tag">Javascript</a>, <a href="http://www.static-eric.com/tag/jquery/" rel="tag">jQuery</a>, <a href="http://www.static-eric.com/tag/python/" rel="tag">Python</a></p>				<p><strong>Comments/Trackbacks:</strong>
								<a href="#respond">Comments</a>, or <a href="http://www.static-eric.com/2011/10/27/making-search-possible-on-a-static-site/trackback/" rel="trackback">trackback</a> allowed.</p>
	
								</p>
			</div>
	
<div id="disqus_thread">
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://www.static-eric.com/2011/10/27/making-search-possible-on-a-static-site/';
    var disqus_identifier = '45 http://www.static-eric.com/?p=45';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'static-eric';
    var disqus_title = "Making search possible on a static site";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=45');
        });
                    };
    var facebookXdReceiverPath = 'http://www.static-eric.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/static\/wordpress\/2011\/10\/27\/making-search-possible-on-a-static-site\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
	</div>		
</div>

	<div id="footer">
		<p>&copy; 2010 Eric van Zanten &#8211; Statically | Powered by <a href="http://www.sorben.org/really-static/">really static WordPress</a> | Theme: <a href="http://leonewball.com/portfolio/tabula-rosa/">tabula rosa</a> | <a href="http://www.static-eric.com/feed/">RSS Feed</a></p>
	</div>

<script type='text/javascript' src='http://www.static-eric.com/wp-content/themes/tabula-rosa/js/menuslide.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/themes/tabula-rosa/js/togglewidgets.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/themes/tabula-rosa/js/fancybox/jquery.fancybox-1.3.4.js?ver=1.3.4'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/themes/tabula-rosa/js/fancybox_settings.js?ver=1.0'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83c'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83c'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83c'></script>
<script type='text/javascript' src='http://www.static-eric.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83c'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://www.static-eric.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://www.static-eric.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="http://www.static-eric.com/wp-content/themes/tabula-rosa/js/search.js"></script>
</body>
</html>
